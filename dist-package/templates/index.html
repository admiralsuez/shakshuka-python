<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shakshuka - Modern Task Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ range(1000, 9999) | random }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h1>Shakshuka</h1>
                </div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" data-page="tasks" title="View and manage all your tasks">
                    <i class="fas fa-tasks"></i>
                    <span>My Tasks</span>
                </div>
                <div class="nav-item" data-page="planner" title="Plan your day with hourly scheduling">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Daily Planner</span>
                </div>
                <div class="nav-item" data-page="analytics" title="View your productivity analytics">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </div>
                <div class="nav-item" id="import-tasks-btn" title="Import Tasks from CSV">
                    <i class="fas fa-file-import"></i>
                    <span>Import Tasks</span>
                </div>
                <div class="nav-item" data-page="settings" title="Configure app settings and preferences">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="nav-item sidebar-toggle-item" id="sidebar-toggle" title="Toggle Sidebar">
                    <i class="fas fa-bars"></i>
                    <span>Toggle Sidebar</span>
                </div>
                <div class="nav-item kill-app-item" id="kill-app-btn" title="Stop Shakshuka Server">
                    <i class="fas fa-power-off"></i>
                    <span>Kill App</span>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Daily Tasks Page -->
            <!-- Analytics Page -->
            <div id="analytics-page" class="page">
                <div class="page-header">
                    <h2>Analytics</h2>
                </div>

                <div class="dashboard-grid">
                    <!-- Stats Cards -->
                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="completed-today">0</h3>
                            <p>Completed Today</p>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="expired-tasks">0</h3>
                            <p>Expired Tasks</p>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="streak-days">0</h3>
                            <p>Day Streak</p>
                        </div>
                    </div>

                    <div class="stats-card">
                        <div class="stats-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stats-content">
                            <h3 id="productivity-score">85%</h3>
                            <p>Productivity</p>
                        </div>
                    </div>

                    <!-- Recent Tasks -->
                    <div class="recent-tasks">
                        <h3>Recent Tasks</h3>
                        <div id="recent-tasks-list" class="tasks-list">
                            <!-- Tasks will be loaded here -->
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h3>Quick Actions</h3>
                        <div class="action-buttons">
                            <button class="action-btn" id="quick-add-btn" title="Quickly add a new task">
                                <i class="fas fa-plus"></i>
                                <span>Quick Add</span>
                            </button>
                            <button class="action-btn" id="focus-mode-btn" title="Enter focus mode for distraction-free work">
                                <i class="fas fa-eye"></i>
                                <span>Focus Mode</span>
                            </button>
                            <button class="action-btn" id="schedule-btn" title="Go to daily planner to schedule tasks">
                                <i class="fas fa-calendar"></i>
                                <span>Schedule</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Page -->
            <div id="tasks-page" class="page active">
                <div class="page-header">
                    <h2>My Tasks</h2>
                    <div class="header-actions">
                        <div class="filter-tabs">
                            <button class="filter-tab active" data-filter="active">Active</button>
                            <button class="filter-tab" data-filter="expired">Expired</button>
                            <button class="filter-tab" data-filter="completed">Completed</button>
                        </div>
                        <div class="layout-toggle">
                            <button class="layout-btn active" data-layout="list" title="List View">
                                <i class="fas fa-list"></i>
                            </button>
                            <button class="layout-btn" data-layout="grid" title="Grid View">
                                <i class="fas fa-th"></i>
                            </button>
                        </div>
                        <div class="action-buttons-group">
                            <button class="btn-primary" id="add-task-btn-2">
                                <i class="fas fa-plus"></i>
                                Add Task
                            </button>
                        </div>
                    </div>
                </div>

                <div class="tasks-container">
                    <div id="tasks-list" class="tasks-list">
                        <!-- Tasks will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Planner Page -->
            <div id="planner-page" class="page">
                <div class="page-header">
                    <h2>Daily Planner</h2>
                    <div class="header-actions">
                        <button class="btn-secondary" id="add-task-to-planner" title="Add Task to Planner">
                            <i class="fas fa-plus"></i>
                            Add Task
                        </button>
                        <div class="date-selector">
                            <button id="prev-day" class="date-btn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="current-date">Today</span>
                            <button id="next-day" class="date-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="planner-container">
                    <div class="time-grid">
                        <!-- Time slots will be generated here -->
                    </div>
                    <div class="task-pool">
                        <h3>Available Tasks</h3>
                        <div id="available-tasks" class="draggable-tasks">
                            <!-- Available tasks for dragging -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page">
                <div class="page-header">
                    <h2>Settings</h2>
                </div>

                <div class="settings-container">
                    <div class="settings-section">
                        <h3>General</h3>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="autostart-toggle">
                                <span class="toggle-slider"></span>
                                Start with Windows
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                Auto-save interval:
                                <select id="autosave-interval">
                                    <option value="15">15 seconds</option>
                                    <option value="30" selected>30 seconds</option>
                                    <option value="60">1 minute</option>
                                    <option value="300">5 minutes</option>
                                </select>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                Daily reset time:
                                <input type="time" id="daily-reset-time" value="09:00">
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Appearance</h3>
                        <div class="setting-item">
                            <label>
                                Theme:
                                <select id="theme-selector">
                                    <option value="light">Light (Orange)</option>
                                    <option value="dark">Dark (Blue)</option>
                                    <option value="orange" selected>Orange/Peach</option>
                                    <option value="self-esteem">Self-Esteem (Mint Green)</option>
                                    <option value="anxiety">Anxiety (Sky Blue)</option>
                                    <option value="auto">Auto</option>
                                </select>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                DPI Scale:
                                <select id="dpi-selector">
                                    <option value="75">75% (Compact)</option>
                                    <option value="100" selected>100% (Normal)</option>
                                    <option value="125">125% (Large)</option>
                                    <option value="150">150% (Extra Large)</option>
                                </select>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Security</h3>
                        <div class="setting-item">
                            <button class="btn-secondary" id="change-password-btn">
                                <i class="fas fa-key"></i>
                                Change Password
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Developer</h3>
                        <div class="setting-item">
                            <button class="btn-secondary" id="view-logs-btn">
                                <i class="fas fa-bug"></i>
                                View Developer Logs
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Updates & Backups</h3>
                        <div class="setting-item">
                            <button class="btn-secondary" id="check-updates-btn">
                                <i class="fas fa-sync"></i>
                                Check for Updates
                            </button>
                            <button class="btn-secondary" id="create-backup-btn">
                                <i class="fas fa-save"></i>
                                Create Backup
                            </button>
                            <button class="btn-secondary" id="manage-backups-btn">
                                <i class="fas fa-history"></i>
                                Manage Backups
                            </button>
                        </div>
                        
                        <div class="setting-item">
                            <label class="setting-label">
                                <span>Auto-check for updates</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="auto-update-check">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label class="setting-label">
                                <span>Auto-install updates</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="auto-update-install">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label class="setting-label">
                                <span>Backup before updates</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="backup-before-update" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label for="update-channel">Update Channel:</label>
                            <select id="update-channel">
                                <option value="stable">Stable</option>
                                <option value="beta">Beta</option>
                                <option value="alpha">Alpha</option>
                            </select>
                        </div>
                        
                        <div class="setting-item">
                            <label for="check-interval">Check Interval (hours):</label>
                            <input type="number" id="check-interval" min="1" max="168" value="24">
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Account</h3>
                        <div class="setting-item">
                            <button class="btn-secondary" id="logout-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Task Modal -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Task</h3>
                <button class="modal-close" id="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="task-form">
                    <div class="form-group">
                        <label for="task-title">Task Title</label>
                        <input type="text" id="task-title" required>
                    </div>
                    <div class="form-group">
                        <label for="task-description">Description</label>
                        <textarea id="task-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="task-project">Project</label>
                        <input type="text" id="task-project" placeholder="e.g., Work, Personal, Health">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-due-date">Due Date</label>
                            <input type="date" id="task-due-date">
                        </div>
                        <div class="form-group">
                            <label for="task-duration">Duration (minutes)</label>
                            <input type="number" id="task-duration" value="60" min="5" max="480">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-task">Cancel</button>
                <button type="submit" class="btn-primary" id="save-task">Save Task</button>
            </div>
        </div>
    </div>

    <!-- Quick Add Modal -->
    <div id="quick-add-modal" class="modal">
        <div class="modal-content quick-add">
            <div class="modal-header">
                <h3>Quick Add Task</h3>
                <button class="modal-close" id="close-quick-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="quick-task-form">
                    <div class="form-group">
                        <input type="text" id="quick-task-title" placeholder="What needs to be done?" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-quick-task">Cancel</button>
                <button type="submit" class="btn-primary" id="save-quick-task">Add Task</button>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button class="modal-close" id="close-password-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="password-form">
                    <div class="form-group">
                        <label for="current-password">Current Password</label>
                        <input type="password" id="current-password" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">New Password</label>
                        <input type="password" id="new-password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm New Password</label>
                        <input type="password" id="confirm-password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-password">Cancel</button>
                <button type="submit" class="btn-primary" id="save-password">Change Password</button>
            </div>
        </div>
    </div>

        <!-- Schedule Modal -->
        <div id="schedule-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Schedule Task</h3>
                    <button class="modal-close" id="close-schedule-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="schedule-form">
                        <div class="form-group">
                            <label for="schedule-hour">Time:</label>
                            <select id="schedule-hour" required>
                                <option value="">Select time</option>
                                <option value="06:00">6:00 AM</option>
                                <option value="07:00">7:00 AM</option>
                                <option value="08:00">8:00 AM</option>
                                <option value="09:00">9:00 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="12:00">12:00 PM</option>
                                <option value="13:00">1:00 PM</option>
                                <option value="14:00">2:00 PM</option>
                                <option value="15:00">3:00 PM</option>
                                <option value="16:00">4:00 PM</option>
                                <option value="17:00">5:00 PM</option>
                                <option value="18:00">6:00 PM</option>
                                <option value="19:00">7:00 PM</option>
                                <option value="20:00">8:00 PM</option>
                                <option value="21:00">9:00 PM</option>
                                <option value="22:00">10:00 PM</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="schedule-duration">Duration (minutes):</label>
                            <select id="schedule-duration" required>
                                <option value="15">15 minutes</option>
                                <option value="30" selected>30 minutes</option>
                                <option value="45">45 minutes</option>
                                <option value="60">1 hour</option>
                                <option value="90">1.5 hours</option>
                                <option value="120">2 hours</option>
                                <option value="180">3 hours</option>
                                <option value="240">4 hours</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancel-schedule">Cancel</button>
                    <button type="button" class="btn-primary" id="confirm-schedule">
                        <i class="fas fa-calendar-plus"></i>
                        Schedule Task
                    </button>
                </div>
            </div>
        </div>

        <!-- Strike Modal -->
    <div id="strike-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Strike Task</h3>
                <button class="modal-close" id="close-strike-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="strike-form">
                    <div class="form-group">
                        <label for="strike-report">What did you accomplish?</label>
                        <textarea id="strike-report" placeholder="Describe what you completed or accomplished..." rows="4" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-strike">Cancel</button>
                <button type="button" class="btn-warning" id="strike-today-btn">
                    <i class="fas fa-calendar-day"></i>
                    Strike for Today
                </button>
                <button type="button" class="btn-danger" id="strike-forever-btn">
                    <i class="fas fa-check-circle"></i>
                    Strike Forever
                </button>
            </div>
        </div>
    </div>

    <!-- Developer Logs Modal -->
    <div id="logs-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Developer Logs</h3>
                <button class="modal-close" id="close-logs-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="logs-controls">
                    <button class="btn-secondary" id="clear-logs-btn">
                        <i class="fas fa-trash"></i>
                        Clear Logs
                    </button>
                    <button class="btn-secondary" id="refresh-logs-btn">
                        <i class="fas fa-refresh"></i>
                        Refresh
                    </button>
                </div>
                <div class="logs-container">
                    <pre id="logs-content">Loading logs...</pre>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="close-logs-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h3 id="auth-modal-title">Welcome to Shakshuka</h3>
                <button class="modal-close" id="close-auth-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Setup Form (First Run) -->
                <form id="setup-form" class="auth-form">
                    <div class="form-group">
                        <label for="setup-password">Set Password</label>
                        <input type="password" id="setup-password" required minlength="6" placeholder="Enter a secure password">
                    </div>
                    <div class="form-group">
                        <label for="setup-confirm-password">Confirm Password</label>
                        <input type="password" id="setup-confirm-password" required minlength="6" placeholder="Confirm your password">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn-primary" id="setup-btn">
                            <i class="fas fa-shield-alt"></i>
                            Setup Account
                        </button>
                    </div>
                </form>

                <!-- Login Form -->
                <form id="login-form" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" required placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="remember-password">
                            <span class="checkmark"></span>
                            Remember password
                        </label>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn-primary" id="login-btn">
                            <i class="fas fa-sign-in-alt"></i>
                            Login
                        </button>
                    </div>
                </form>

                <!-- Switch Forms -->
                <div class="auth-switch">
                    <p id="auth-switch-text">Already have an account?</p>
                    <button type="button" class="btn-link" id="auth-switch-btn">Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
        </div>
    </div>

    <!-- Backup Management Modal -->
    <div class="modal" id="backup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Backups</h3>
                <button class="modal-close" id="close-backup-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="backup-list" id="backup-list">
                    <!-- Backup list will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-backup">Close</button>
                <button type="button" class="btn-primary" id="create-new-backup">
                    <i class="fas fa-plus"></i>
                    Create New Backup
                </button>
            </div>
        </div>
    </div>

    <!-- Update Available Modal -->
    <div class="modal" id="update-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Available</h3>
                <button class="modal-close" id="close-update-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="update-info" id="update-info">
                    <!-- Update information will be populated here -->
                </div>
                <div class="update-progress" id="update-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p id="progress-text">Downloading update...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-update">Later</button>
                <button type="button" class="btn-primary" id="download-update">
                    <i class="fas fa-download"></i>
                    Download & Install
                </button>
            </div>
        </div>
    </div>

    <!-- Import Tasks Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Tasks</h3>
                <button class="modal-close" id="close-import-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="import-info">
                    <p>Import tasks from CSV or TXT files. Supported formats:</p>
                    <ul>
                        <li><strong>CSV:</strong> title, description, project, duration, due_date, priority</li>
                        <li><strong>TXT:</strong> Title | Description | Project | Duration | Due Date</li>
                    </ul>
                </div>
                <form id="import-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="import-file">Select File:</label>
                        <input type="file" id="import-file" name="file" accept=".csv,.txt" required>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="import-overwrite">
                            Replace existing tasks (uncheck to add to existing tasks)
                        </label>
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn-secondary" id="download-sample" style="margin-top: 10px;">
                            <i class="fas fa-download"></i>
                            Download Sample CSV Template
                        </button>
                    </div>
                </form>
                <div id="import-preview" style="display: none;">
                    <h4>Preview:</h4>
                    <div id="preview-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancel-import">Cancel</button>
                <button type="button" class="btn-primary" id="confirm-import">
                    <i class="fas fa-file-import"></i>
                    Import Tasks
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
